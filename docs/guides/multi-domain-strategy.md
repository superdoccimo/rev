# Multi-domain Strategy (SAN vs Split)

本番運用での「複数ドメイン」対応をどう設計するかの指針です。

## TL;DR
- 小規模/単独運用: SAN 一括が簡単（1つの cert に複数 SAN）
- 中〜大規模/分業運用: 分割が安全（ドメインごとに cert 分離）

## 比較表
| 観点 | SAN 一括 | 分割 |
|---|---|---|
| 運用の手間 | 少 | 多（複数 cert/更新） |
| 失敗時の影響範囲 | 大（1枚に依存） | 小（個々に独立） |
| ローテーション | 一度で済む | 個別に実施 |
| トラブル切り分け | 難 | 容易 |
| 証明書サイズ/ハンドシェイク | やや大きくなりがち | 個別に最適化可能 |

## 推奨パターン
- SAN: 少数の canonical ドメイン + その www/redirect 程度
- 分割: テナントや部署単位、担当が異なる場合、Risk を分離したい場合

## 実装メモ
- 本リポジトリの `init-letsencrypt.sh` は `domains=(a.com www.a.com)` のように SAN をサポート
- 分割時はリポジトリを複製するか、`conf.d/` で server を分け、certbot もドメインごとに実行
- 更新失敗時の影響範囲: 図解は `docs/diagrams/alternatives.mmd` を参照

